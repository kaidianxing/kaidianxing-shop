(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[150],{"01a8":function(e,t,n){},"2ba44":function(e,t,n){"use strict";n.r(t);var r=n("2e83"),a=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=a.a},"2e83":function(e,t,n){var r=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("ade3")),i=r(n("5530")),c=r(n("2909"));n("d3b7"),n("159b"),n("caad"),n("2532"),n("b0c0"),n("fb6a"),n("ac1f"),n("1276"),n("6062"),n("3ca3"),n("ddb0"),n("5319"),n("c740"),n("a15b");var o={data:function(){return{id:"",formData:{name:"",status:"1",perms:[]},rule:{name:[{required:!0,message:"请填写角色名称"}]},submitLoading:!1}},computed:{allSelectedFlag:function(){return!this.formData.perms.some((function(e){return!1===e.checked||!0===e.indeterminate}))},indeterminate:function(){var e=this.formData.perms.some((function(e){return!0===e.indeterminate})),t=this.formData.perms.some((function(e){return!1===e.checked})),n=this.formData.perms.some((function(e){return!0===e.checked}));return e||t&&n}},created:function(){this.$route.query.id?(this.id=this.$route.query.id,this.editRole()):this.getAllPerms()},methods:{getAllPerms:function(){var e=this;this.$api.settingApi.getAllPerms({}).then((function(t){0==t.error&&(t.data.forEach((function(e){e["checked"]=!1,e["showFlag"]=!1,e.children.forEach((function(e){e["checked"]=!1,e.perm.forEach((function(e){e["checked"]=!1}))}))})),e.formData.perms=(0,c.default)(t.data))}))},editRole:function(){var e=this;this.$api.settingApi.editRole({id:this.id}).then((function(t){0==t.error&&(t.data.all_perm.forEach((function(e){if(e["showFlag"]=!1,e.children&&e.children.length>0){e.children.forEach((function(e){if(e.perm&&e.perm.length>0){e.perm.forEach((function(e){t.data.has_perm.includes(e.perm_key)?e.checked=!0:e.checked=!1}));var n=e.perm.some((function(e){return!1===e.checked})),r=e.perm.some((function(e){return!0===e.checked}));e.indeterminate=n&&r,e.checked=!n}else e.checked=!1}));var n=e.children.some((function(e){return!0===e.indeterminate})),r=e.children.some((function(e){return!1===e.checked})),a=e.children.some((function(e){return!0===e.checked}));e.indeterminate=n||r&&a,e.checked=!r}else e.checked=!1})),e.formData=(0,i.default)((0,i.default)({},e.formData),{},{name:t.data.name,status:t.data.status+"",perms:(0,c.default)(t.data.all_perm)}))}))},changeAllSelectedFlag:function(e){this.formData.perms.forEach((function(t){t.checked=e,t.indeterminate=!1,t.children.forEach((function(t){t.checked=e,t.indeterminate=!1,t.perm.forEach((function(t){t.checked=e,t.indeterminate=!1}))}))}))},changeChecked:function(e){this.formData.perms[e].indeterminate=!1;var t=this.formData.perms[e].checked;this.formData.perms[e].children.forEach((function(e){e.indeterminate=!1,e.checked=t,e.perm.forEach((function(e){e.checked=t}))})),this.formData.perms=this.formData.perms.slice(0)},changeSecChecked:function(e,t){this.formData.perms[e].children[t].indeterminate=!1;var n=this.formData.perms[e].children[t].checked;this.formData.perms[e].children[t].perm.forEach((function(e){e.checked=n})),this.handleCheckedChange(e)},changeThiChecked:function(e,t,n){var r=this.formData.perms[e].children[t].perm[n].checked,a=this.formData.perms[e].children[t].perm,i=a[n].perm_key,c=i.split(".");if(r){if(new Set(c).has("manage")){var o=i.replace(/manage/g,"view"),s=a.findIndex((function(e){return e.perm_key===o}));-1!==s&&(this.formData.perms[e].children[t].perm[s].checked=r)}}else if(new Set(c).has("view")){var d=i.replace(/view/g,"manage"),h=a.findIndex((function(e){return e.perm_key===d}));-1!==h&&(this.formData.perms[e].children[t].perm[h].checked=r)}var l=this.formData.perms[e].children[t].perm.some((function(e){return!1===e.checked})),m=this.formData.perms[e].children[t].perm.some((function(e){return!0===e.checked}));this.formData.perms[e].children[t].indeterminate=l&&m,this.formData.perms[e].children[t].checked=!l,this.handleCheckedChange(e)},handleCheckedChange:function(e){var t=this.formData.perms[e].children.some((function(e){return!0===e.indeterminate})),n=this.formData.perms[e].children.some((function(e){return!1===e.checked})),r=this.formData.perms[e].children.some((function(e){return!0===e.checked}));this.formData.perms[e].indeterminate=t||n&&r,this.formData.perms[e].checked=!n,this.formData.perms=this.formData.perms.slice(0)},onValidate:function(e,t){this.cacheError=(0,i.default)((0,i.default)({},this.cacheError),{},(0,a.default)({},e,t))},validate:function(){var e=this;return new Promise((function(t){e.$refs["form"].validate((function(n){t(n),e.$nextTick((function(){if(!n)for(var t in e.cacheError)if(!e.cacheError[t]){e.$focusError(t);break}}))}))}))},handleSave:function(){var e=this;this.validate().then((function(t){t&&(e.submitLoading=!0,e.id?e.saveRole():e.createRole())}))},saveRole:function(){var e=this,t=[];this.formData.perms.forEach((function(e){e.children&&e.children.length>0&&e.children.forEach((function(e){e.perm&&e.perm.length>0&&e.perm.forEach((function(e){e.checked&&t.push(e.perm_key)}))}))}));var n={id:this.id,name:this.formData.name,status:this.formData.status,perms:t.join("|")};this.$api.settingApi.saveRole((0,i.default)({},n)).then((function(t){e.submitLoading=!1,0==t.error&&(e.$Message.success("保存成功"),e.$router.go(-1))}))},createRole:function(){var e=this,t=[];this.formData.perms.forEach((function(e){e.children&&e.children.length>0&&e.children.forEach((function(e){e.perm&&e.perm.length>0&&e.perm.forEach((function(e){e.checked&&t.push(e.perm_key)}))}))}));var n={name:this.formData.name,status:this.formData.status,perms:t.join("|")};this.$api.settingApi.createRole((0,i.default)({},n)).then((function(t){e.submitLoading=!1,0==t.error&&(e.$Message.success("保存成功"),e.$router.go(-1))}))}}};t.default=o},3978:function(e,t,n){"use strict";n.r(t);var r=n("447f"),a=n("2ba44");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("fe2a");var c=n("2877"),o=Object(c["a"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"4c6119bd",null);t["default"]=o.exports},"447f":function(e,t,n){"use strict";var r=n("d5bf");n.o(r,"render")&&n.d(t,"render",(function(){return r["render"]})),n.o(r,"staticRenderFns")&&n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]}))},d5bf:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.staticRenderFns=t.render=void 0,n("b0c0");var r=function(){var e=this,t=e._self._c;return t("kdx-content-bar",{scopedSlots:e._u([{key:"btn",fn:function(){return[t("Button",{staticClass:"primary-long",attrs:{loading:e.submitLoading},on:{click:e.handleSave}},[e._v(" 保存 ")])]},proxy:!0}])},[t("div",{staticClass:"content"},[t("div",{staticClass:"title"},[t("kdx-form-title",[e._v("编辑角色")])],1),t("Form",{ref:"form",attrs:{model:e.formData,"label-width":120,rules:e.rule},on:{"on-validate":e.onValidate}},[t("FormItem",{directives:[{name:"error-item",rawName:"v-error-item.name",modifiers:{name:!0}}],attrs:{label:"角色：",prop:"name"}},[t("Input",{staticClass:"width-340",attrs:{placeholder:"请输入",maxlength:"15","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("FormItem",{attrs:{label:"状态："}},[t("RadioGroup",{model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},[t("Radio",{attrs:{label:"1"}},[t("span",[e._v("启用")])]),t("Radio",{attrs:{label:"0"}},[t("span",[e._v("禁用")])])],1),t("kdx-hint-text",[e._v(" 如果禁用，则当前角色的操作员全部会禁止使用 ")])],1),e.formData.perms.length?t("FormItem",{attrs:{label:"可用权限：",prop:"perms"}},[t("div",{staticClass:"all"},[t("Checkbox",{attrs:{border:"",value:e.allSelectedFlag,indeterminate:e.indeterminate},on:{"on-change":e.changeAllSelectedFlag}},[e._v(" 全部选择 ")])],1),t("div",{staticClass:"collapse"},[t("ul",e._l(e.formData.perms,(function(n,r){return t("li",{key:r,staticClass:"collapse-item"},[t("div",{staticClass:"header"},[t("span",{staticClass:"icon iconfont",class:{"icon-full-right":!n.showFlag,"icon-full-down":n.showFlag},on:{click:function(e){n.showFlag=!n.showFlag}}}),t("Checkbox",{attrs:{indeterminate:n.indeterminate},on:{"on-change":function(t){return e.changeChecked(r)}},model:{value:n.checked,callback:function(t){e.$set(n,"checked",t)},expression:"item.checked"}},[e._v(" "+e._s(n.title)+" ")])],1),t("div",{staticClass:"body",class:{show:n.showFlag}},[t("ul",e._l(n.children,(function(n,a){return t("li",{key:a},[t("div",{staticClass:"left"},[t("Checkbox",{attrs:{indeterminate:n.indeterminate},on:{"on-change":function(t){return e.changeSecChecked(r,a)}},model:{value:n.checked,callback:function(t){e.$set(n,"checked",t)},expression:"secItem.checked"}},[e._v(" "+e._s(n.title)+" ")])],1),t("div",{staticClass:"right"},e._l(n.perm,(function(n,i){return t("div",{key:i},[t("Checkbox",{on:{"on-change":function(t){return e.changeThiChecked(r,a,i)}},model:{value:n.checked,callback:function(t){e.$set(n,"checked",t)},expression:"\n                                                            thiItem.checked\n                                                        "}},[e._v(" "+e._s(n.title)+" ")])],1)})),0)])})),0)])])})),0)])]):e._e()],1)],1)])};t.render=r;var a=[];t.staticRenderFns=a},fe2a:function(e,t,n){"use strict";n("01a8")}}]);